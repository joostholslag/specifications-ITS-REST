<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.21">
<meta name="description" content="openEHR SMART App Launch and Service Discovery Framework (SMART)">
<meta name="keywords" content="JSON, REST, SMART, OAuth2, OIDC, Authentication, Authorization, Application, App">
<title>SMART on openEHR (SMART)</title>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/openehr.css">
<link rel="stylesheet" href="https://specifications.openehr.org/styles/pygments-default.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_smart_on_openehr_smart">SMART on openEHR (SMART)</a>
<ul class="sectlevel1">
<li><a href="#_amendment_record">Amendment Record</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_primary_author">Primary Author</a></li>
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_trademarks">Trademarks</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_related_documents">1.2. Related Documents</a></li>
<li><a href="#_status">1.3. Status</a></li>
<li><a href="#_feedback">1.4. Feedback</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_background">2.1. Background</a></li>
<li><a href="#_glossary">2.2. Glossary</a></li>
<li><a href="#_why_smart_on_openehr">2.3. Why SMART on openEHR?</a></li>
<li><a href="#_requirements">2.4. Requirements</a></li>
</ul>
</li>
<li><a href="#_application_registration">3. Application Registration</a></li>
<li><a href="#_service_discovery">4. Service Discovery</a>
<ul class="sectlevel2">
<li><a href="#_authentication_endpoints">4.1. Authentication endpoints</a></li>
<li><a href="#_services">4.2. Services</a></li>
<li><a href="#_capabilities">4.3. Capabilities</a></li>
</ul>
</li>
<li><a href="#_authentication_authorization_and_scopes">5. Authentication, Authorization and Scopes</a>
<ul class="sectlevel2">
<li><a href="#_authentication">5.1. Authentication</a>
<ul class="sectlevel3">
<li><a href="#_available_flows">5.1.1. Available flows</a></li>
<li><a href="#_application_types">5.1.2. Application types</a></li>
</ul>
</li>
<li><a href="#_smart_authorization_flow">5.2. SMART Authorization Flow</a>
<ul class="sectlevel3">
<li><a href="#_context_selection">5.2.1. Context Selection</a></li>
<li><a href="#_embedded_iframe_launch">5.2.2. Embedded iFrame Launch</a></li>
</ul>
</li>
<li><a href="#_scopes_for_openehr_rest_api">5.3. Scopes for openEHR REST API</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="https://specifications.openehr.org/images/openEHR_logo_RGB.svg" alt="openEHR logo">
</div>
</div>
</div>
</div>
<h1 id="_smart_on_openehr_smart" class="sect0"><a class="anchor" href="#_smart_on_openehr_smart"></a>SMART on openEHR (SMART)</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all fit-content spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="https://www.openehr.org/programs/specification" target="_blank" rel="noopener">openEHR Specification Program</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: ITS-REST latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: DEVELOPMENT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: JSON, REST, SMART, OAuth2, OIDC, Authentication, Authorization, Application, App</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<object type="image/svg+xml" data="openehr_block_diagram.svg" width="60%"><span class="alt">openEHR components</span></object>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2023 - 2024 The openEHR Foundation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="https://www.openehr.org" target="_blank" rel="noopener">The openEHR Foundation</a> is an independent, non-profit foundation, facilitating the sharing of health records by consumers and clinicians via open specifications, clinical models and open platform implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 3.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/3.0/" class="bare">https://creativecommons.org/licenses/by-nd/3.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://specifications.openehr.org/components/ITS-REST/open_issues" target="_blank" rel="noopener">Problem Reports</a><br>
 Web: <a href="https://specifications.openehr.org" target="_blank" rel="noopener">specifications.openEHR.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_amendment_record"><a class="anchor" href="#_amendment_record"></a>Amendment Record</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>ITS_REST Release (unreleased)</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue"></a>1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECITS-69" target="_blank" rel="noopener">SPECITS-69</a>. Adding "SMART on openEHR" specifications.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Ramesh,<br>
S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue_date"></a>09 Sep 2023</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primary_author"><a class="anchor" href="#_primary_author"></a>Primary Author</h3>
<div class="ulist">
<ul>
<li>
<p>Sidharth Ramesh; Medblocks.</p>
</li>
<li>
<p>Sebastian Iancu; Architect, Code24, Netherlands</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>Contributors</h3>
<div class="paragraph">
<p>This specification has benefited from formal and informal input from the openEHR and wider health informatics community. The openEHR Foundation would like to recognise the following for their contributions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ian McNicoll MD, FreshEHR, UK</p>
</li>
<li>
<p>Bostjan Lah, Senior Architect, Better, Slovenia</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A significant part of the design ideas of this specification was derived from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the SMART on FHIR protocol - SMART App Launch Release 2.1.0, published by HL7® FHIR® standard</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trademarks"><a class="anchor" href="#_trademarks"></a>Trademarks</h3>
<div class="ulist">
<ul>
<li>
<p>'openEHR' is a registered trademark of the openEHR Foundation</p>
</li>
<li>
<p>HL7® and FHIR® are the registered trademark of the Health Level Seven International and their use does not constitute endorsement by HL7</p>
</li>
<li>
<p>SMART™ and the SMART logos are trademarks of The Children’s Medical Center Corporation. Used with permission.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>This document describes the SMART protocol for an openEHR platform.</p>
</div>
<div class="paragraph">
<p>The intended audience includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EHR systems, Platform or Application vendors;</p>
</li>
<li>
<p>Standards bodies producing health informatics standards;</p>
</li>
<li>
<p>Solution vendors.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_documents"><a class="anchor" href="#_related_documents"></a>1.2. Related Documents</h3>
<div class="paragraph">
<p>Prerequisite documents for reading this document include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html" target="_blank" rel="noopener">openEHR Architecture Overview</a></p>
</li>
<li>
<p><a href="https://specifications.openehr.org/releases/ITS-REST/latest">openEHR REST APIs</a></p>
</li>
<li>
<p><a href="https://www.hl7.org/fhir/smart-app-launch/" target="_blank" rel="noopener">SMART on FHIR</a></p>
</li>
<li>
<p>'About SMART' page on <a href="https://smarthealthit.org/about-smart-2/" target="_blank" rel="noopener">SMART Health IT</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">OAuth2</a> and <a href="https://openid.net/specs/openid-connect-core-1_0.html#Authentication" target="_blank" rel="noopener">OpenId Connect (OIDC)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.3. Status</h3>
<div class="paragraph">
<p>This specification is in the DEVELOPMENT state. The development version of this document can be found at <a href="https://specifications.openehr.org/releases/ITS-REST/latest/smart_app_launch.html" target="_blank" rel="noopener">https://specifications.openehr.org/releases/ITS-REST/latest/smart_app_launch.html</a>.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.4. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="https://discourse.openehr.org/c/specifications/its" target="_blank" rel="noopener">openEHR ITS forum</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://specifications.openehr.org/components/ITS-REST/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://specifications.openehr.org/components/ITS-REST/history" target="_blank" rel="noopener">ITS-REST component Change Request tracker</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_background"><a class="anchor" href="#_background"></a>2.1. Background</h3>
<div class="paragraph">
<p><strong>SMART</strong> stands for “Substitutable Medical Applications and Reusable Technologies”, a healthcare standard through which applications can access clinical information through a data store. It was initially proposed by <a href="https://smarthealthit.org/" target="_blank" rel="noopener">SMART Health IT</a> project (run by Boston Children’s Hospital Computational Health Informatics Program) and was later specified as <a href="https://www.hl7.org/fhir/smart-app-launch/" target="_blank" rel="noopener">SMART on FHIR</a>, a protocol which works on top of the <a href="https://www.hl7.org/fhir" target="_blank" rel="noopener">FHIR APIs</a> facilitating access to data. The specification builds on <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">OAuth2</a> and <a href="https://openid.net/specs/openid-connect-core-1_0.html#Authentication" target="_blank" rel="noopener">OpenID Connect (OIDC)</a>, which are industry standards for authentication and authorization, and allows 3rd-party applications to authorize and seamlessly work with any system that implements the protocol.</p>
</div>
</div>
<div class="sect2">
<h3 id="_glossary"><a class="anchor" href="#_glossary"></a>2.2. Glossary</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vendor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entity that provides software to end-users.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the real person who is using the Application to perform some function. This is often referred to as the "end-user".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A software application developed by a vendor, designed to work with the Platform and/or Launcher built by the same or different vendor. This is also known as the "client" in terms of OAuth roles, and often referred to as the "SMART App" by <em>SMART on FHIR</em> specification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A software system consisting at least of an Authorization Server, an openEHR Clinical Data Repository (CDR) and a FHIR Server, providing openEHR REST APIs, FHIR APIs and potentially other APIs. This is sometimes also known in the <em>SMART on FHIR</em> specification as the "EHR system". The authentication and authorization server that provides APIs consistent with the OAuth2 framework specification and the SMART on openEHR protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Launcher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-facing software, usually built by the Platform vendor, that serves to launch other Applications within a context of a Patient or Practitioner. The Launcher can be part of the Platform (i.e. a Portal) or a completely separate application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EHR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A (session) context that relates to an <a href="https://specifications.openehr.org/releases/RM/latest/ehr.html#_ehr_package" target="_blank" rel="noopener">openEHR <code>EHR</code> container</a> and the associated Patient, representing the subject on which the Application will work.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://www.hl7.org/fhir/smart-app-launch/" target="_blank" rel="noopener">SMART on FHIR</a> specifications uses the term '<em>EHR</em>' and '<em>EHR system</em>' to refer to a software system comprising a FHIR Server, Authorization Server and potentially other components, including a <em>Launcher</em>.
On the other hand, openEHR has specification for an <a href="https://specifications.openehr.org/releases/RM/latest/ehr.html" target="_blank" rel="noopener">EHR Information Model</a>, including a <a href="https://specifications.openehr.org/releases/RM/latest/ehr.html#_root_ehr_object" target="_blank" rel="noopener">root <code>EHR</code> container</a>.</p>
</div>
<div class="paragraph">
<p>In order to avoid any confusion between the meaning of '<em>EHR</em>' in the context of SMART, this specification will only use this term in relation with openEHR concepts (i.e. EHR type, EHR ID, etc.), and will use substitutes for FHIR&#8217;s '<em>EHR</em>' concept.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_why_smart_on_openehr"><a class="anchor" href="#_why_smart_on_openehr"></a>2.3. Why SMART on openEHR?</h3>
<div class="paragraph">
<p>A popular vision nowadays is considering that a single software vendor cannot provide all the necessary tools and software for a healthcare system while still maintaining a high level of quality and a low cost of ownership. Independent vendors who focus on a specific topic or problem to be solved may have an edge over monolithic "suites" of software that try to do everything.</p>
</div>
<div class="paragraph">
<p>In practice, this requires applications from multiple vendors working together to provide a complete solution, often named "best-of-breed" architecture. This is implemented currently by long tedious manual "integration" phase, where the multiple vendors collaborate to make their software work together - a very expensive process, often a major barrier to entry for new vendors.</p>
</div>
<div class="paragraph">
<p>The SMART specification aims to solve this problem by providing a standard way for systems and applications to work together, as it defines a contract between the <em>Application vendor</em> and the <em>Platform vendor</em>. This contract covers the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>Application</em> should have the ability to be hosted on a domain owned by the <em>Application vendor</em></p>
</li>
<li>
<p>The <em>Platform</em> should have the ability to be hosted on a domain owned by the <em>Platform vendor</em></p>
</li>
<li>
<p>The <em>Application</em> needs a way to discover API services offered by the <em>Platform</em></p>
</li>
<li>
<p>The <em>Application</em> needs a way to authenticate with the <em>Platform</em> to access the APIs offered by the <em>Platform</em></p>
</li>
<li>
<p>The <em>Application</em> needs a way to understand the "context" while they are open, by letting the <em>Platform</em> handle EHR and Episode selection</p>
</li>
<li>
<p>The <em>Application</em> needs a way to embed within the <em>Platform</em>'s user interface while maintaining the "context" to provide a seamless user experience</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>SMART on openEHR</strong> specification aims to maintain compatibility with <a href="https://www.hl7.org/fhir/smart-app-launch/" target="_blank" rel="noopener">SMART on FHIR</a> while making this protocol work also with <a href="https://specifications.openehr.org/releases/ITS-REST/latest" target="_blank" rel="noopener">openEHR REST APIs</a> and potentially more other APIs. It is meant to describe a framework for the following aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_application_registration">Application Registration</a></p>
</li>
<li>
<p><a href="#_service_discovery">Service Discovery</a></p>
</li>
<li>
<p><a href="#_authentication_authorization_and_scopes">Authentication, Authorization and Scopes</a></p>
</li>
<li>
<p><a href="#_context_selection">Context Selection</a></p>
</li>
<li>
<p><a href="#_embedded_iframe_launch">Embedded iFrame Launch</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_requirements"><a class="anchor" href="#_requirements"></a>2.4. Requirements</h3>
<div class="paragraph">
<p>The <a href="https://specifications.openehr.org/releases/RM/latest/index" target="_blank" rel="noopener">openEHR Reference Model</a> and <a href="https://specifications.openehr.org/releases/ITS-REST/latest/ehr.html" target="_blank" rel="noopener">openEHR REST API specification</a> provide a foundation for interoperable <em>Applications</em>. For such applications to be truly portable between systems and vendors, there is a requirement for a uniform <em>authentication</em> and <em>authorization</em> process.</p>
</div>
<div class="paragraph">
<p>Many of such applications also function in the <em>context</em> of a single EHR or Patient, and potentially of a single Episode. Selection of this <em>context</em> also becomes essential before lunching the <em>Application</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_registration"><a class="anchor" href="#_application_registration"></a>3. Application Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <em>Application</em> needs to first register itself with the <em>Platform</em> that it needs to integrate with. This process involves the followings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>Application</em> registers with the <em>Platform</em> by providing the appropriate ID, OAuth2 Scopes, Launch Contexts, Domains, Redirect URLs (<code>redirect_uri</code>) etc.</p>
</li>
<li>
<p>The <em>Application</em> obtains credentials like the <code>client_id</code>, JSON Web Keys or  <code>client_secret</code> from the <em>Platform</em> for authentication and authorization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While this process could be formalised and automated in the future using protocols like <a href="https://tools.ietf.org/html/rfc7591" target="_blank" rel="noopener">OAuth2 Dynamic Client Registration Protocol</a>, the current recommendation is to do this out-of-band in a way that makes sense for the Application Vendor and the Platform Vendor. For example, the Platform vendor could offer a Registration Page that Application Vendors could use to register their applications, and can have an approval and audit mechanism before applications are registered.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_discovery"><a class="anchor" href="#_service_discovery"></a>4. Service Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>Platform</em> usually has multiple endpoints of interest. Some of these are the OAuth2&#8217;s endpoints, like the Token and Authentication endpoints, while others are data resource or service endpoints defined by the openEHR REST APIs, FHIR APIs, DICOMWeb APIs, or other vendor&#8217;s proprietary APIs.</p>
</div>
<div class="paragraph">
<p>The <strong>SMART Service Discovery</strong> builds on the FHIR <a href="https://www.hl7.org/fhir/smart-app-launch/conformance.html#using-well-known" target="_blank" rel="noopener"><code>.well-known/smart-configuration</code></a> and enables a <em>Platform</em> to advertise multiple <a href="#_services">services</a> alongside the OAuth2 endpoints for <a href="#_authentication_endpoints">authentication</a> and any available <a href="#_capabilities">SMART capabilities</a>.</p>
</div>
<div id="smart_service_discovery" class="imageblock text-center text-center">
<div class="content">
<img src="smart_app_launch/diagrams/smart_service_discovery.svg" alt="smart service discovery">
</div>
<div class="title">Figure 1. SMART Service Discovery</div>
</div>
<div class="paragraph">
<p>Given a <em>Platform</em> base URL of <code>https://platform.example.com</code>, the SMART configuration endpoint should be available at the location formed by appending <code>/.well-known/smart-configuration</code> to their base URL, i.e. at <code>https://platform.example.com/.well-known/smart-configuration</code>. This base URL may also contain a path component, e.g. <code>https://platform.example.com/<strong>gateway/v1/</strong></code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In order to maintain compatibility with <em>SMART on FHIR</em> applications, it is recommended that the platform vendor makes the <em>Platform</em> base URL (e.g. <code>https://platform.example.com</code>) also the FHIR server base URL, fulfilling FHIR SMART apps expectations, which assumes that the <code>iss</code> launch parameter is the same as the <code>issuer</code> endpoint advertised in the <code>.well-known/smart-configuration</code> and represents the FHIR server endpoint.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Responses for <code>/.well-known/smart-configuration</code> requests should be always returned in JSON format, using the <code>application/json</code> mime type. An example will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;issuer&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;jwks_uri&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/.well-known/jwks.json&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;authorization_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/auth/authorize&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;token_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/auth/token&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;services&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;org.openehr.rest&quot;</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://platform.example.com/openehr/rest/v1&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;The openEHR REST APIs baseUrl&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;documentation&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://example.com/openehr/docs&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;openapi&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://example.com/openehr/rest/v1/openapi.json&quot;</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;org.fhir.rest&quot;</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://platform.example.com/&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;The FHIR APIs baseUrl&quot;</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;com.amazon.aws.s3.rest&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://s3.example.com/storage&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;documentation&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://example.com/s3/docs&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;openapi&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://example.com/s3/openapi.json&quot;</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;com.example.demographics&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://demographics.example.com/rest&quot;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">},</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;token_endpoint_auth_methods_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;client_secret_basic&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;private_key_jwt&quot;</span>
<span class="tok-w">  </span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;grant_types_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;authorization_code&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;client_credentials&quot;</span>
<span class="tok-w">  </span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;registration_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/auth/register&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;scopes_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s2">&quot;openid&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;profile&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;launch&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;launch/patient&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;patient/*.rs&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;user/*.rs&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;offline_access&quot;</span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;response_types_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;management_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/user/manage&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;introspection_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/user/introspect&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;revocation_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/user/revoke&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;code_challenge_methods_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s2">&quot;S256&quot;</span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;capabilities&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;launch-ehr&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;permission-patient&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;permission-v2&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;client-public&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;client-confidential-symmetric&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;context-ehr-patient&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;sso-openid-connect&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;context-openehr-ehr&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;openehr-permission-v1&quot;</span><span class="tok-p">,</span>
<span class="tok-w">	</span><span class="tok-s2">&quot;launch-base64-json&quot;</span>
<span class="tok-w">  </span><span class="tok-p">]</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The details of the <code>/.well-known/smart-configuration</code> are described in the sections below.</p>
</div>
<div class="sect2">
<h3 id="_authentication_endpoints"><a class="anchor" href="#_authentication_endpoints"></a>4.1. Authentication endpoints</h3>
<div class="paragraph">
<p>The following configurations keys should be exactly the same as in the OAuth2 + OIDC protocol&#8217;s <code>.well-known/openid-configuration</code> as per <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfig" target="_blank" rel="noopener">OpenID Connect Discovery 1.0</a> and <a href="https://www.hl7.org/fhir/smart-app-launch/conformance.html#metadata" target="_blank" rel="noopener">FHIR</a> specifications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isuer</code></p>
</li>
<li>
<p><code>jwks_uri</code></p>
</li>
<li>
<p><code>authorization_endpoint</code></p>
</li>
<li>
<p><code>token_endpoint</code></p>
</li>
<li>
<p><code>token_endpoint_auth_methods_supported</code></p>
</li>
<li>
<p><code>grant_types_supported</code></p>
</li>
<li>
<p><code>scopes_supported</code></p>
</li>
<li>
<p><code>response_types_supported</code></p>
</li>
<li>
<p><code>introspection_endpoint</code></p>
</li>
<li>
<p><code>revocation_endpoint</code></p>
</li>
<li>
<p><code>code_challenge_methods_supported</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services"><a class="anchor" href="#_services"></a>4.2. Services</h3>
<div class="paragraph">
<p>A response from the SMART Configuration endpoint should include besides the <a href="https://www.hl7.org/fhir/smart-app-launch/conformance.html#metadata" target="_blank" rel="noopener">FHIR metadata</a> also a hash of all available <code>services</code> on the <em>Platform</em>. The <code>services</code> section allows the application to discover the APIs of all services that can be used along with their description and documentation. The <code>services</code> section is represented as a hash, where the key is represented by a reverse domain name of the service (e.g. <code>org.openehr.rest</code>), and the value represents the service specification.</p>
</div>
<div class="paragraph">
<p>Listed services should include minimally the openEHR REST APIs endpoints specification available on the <em>Platform</em>, using the key <code>org.openehr.rest</code>. For consistency reason, it is recommended to also include the specification of the FHIR server using the key <code>org.fhir.rest</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.openehr.rest</code>: The base URL of the openEHR REST APIs <code><strong>(required)</strong></code></p>
</li>
<li>
<p><code>org.fhir.rest</code>: The base URL of the FHIR APIs <code><strong>(recommended)</strong></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Platform vendor may add additional services to the services list, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.dicomstandard.dicomweb.rest</code>: The base URL of the DICOMWeb REST API</p>
</li>
<li>
<p><code>com.amazon.aws.s3.rest</code>: The base URL of an AWS S3 compatible REST API</p>
</li>
<li>
<p><code>com.example.demographics</code>: The base URL of a proprietary service that is not part of the openEHR, FHIR or DICOMWeb specifications</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each service specification should include the following configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>baseUrl</code>: The base URL of the service <code><strong>(required)</strong></code></p>
</li>
<li>
<p><code>description</code>: A short description of the service</p>
</li>
<li>
<p><code>documentation</code>: A URL to the documentation of the service</p>
</li>
<li>
<p><code>openapi</code>: A URL to the OpenAPI specification of the service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, the openEHR REST APIs endpoints may be described as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;org.openehr.rest&quot;</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://platform.example.com/openehr/rest/v1&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;The openEHR REST API baseUrl&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;documentation&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/openehr/docs&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;openapi&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://platform.example.com/openehr/rest/v1/openapi.json&quot;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_capabilities"><a class="anchor" href="#_capabilities"></a>4.3. Capabilities</h3>
<div class="paragraph">
<p>The <code>capabilities</code> section is an array that should include all relevant SMART capabilities. Besides <a href="https://www.hl7.org/fhir/smart-app-launch/conformance.html#capabilities" target="_blank" rel="noopener">FHIR capabilities</a>, the following additional values should be used in order to indicate the ability to launch an application using openEHR artefacts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>context-openehr-ehr</code> - support for EHR-level launch context (requested by <code>launch/patient</code> scope, conveyed via <code>ehrId</code> token parameter).</p>
</li>
<li>
<p><code>context-openehr-episode</code> - support for Episode-level launch context (requested by <code>launch/episode</code> scope, conveyed via <code>episodeId</code> token parameter). This capability is deemed experimental.</p>
</li>
<li>
<p><code>openehr-permission-v1</code> - support for the scope and authorization scheme for openEHR REST APIs as described <a href="#_scopes_for_openehr_rest_api">below</a></p>
</li>
<li>
<p><code>launch-base64-json</code> - support for the <code>launch</code> URL parameter being a base64 encoded JSON of the context.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication_authorization_and_scopes"><a class="anchor" href="#_authentication_authorization_and_scopes"></a>5. Authentication, Authorization and Scopes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In general <em>authentication</em> is the process of verifying who the end-user is, while the <em>authorization</em> is the process of verifying what specific functionality or data an end-user has access to.
The SMART profile on the underlying <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">OAuth2.0 framework</a> specifications is designed primarily as a mean of requesting and granting access to resources, focusing mainly on the aspects of the authorization process.</p>
</div>
<div class="paragraph">
<p>The following sections describes these processes in relation with the <strong>SMART on openEHR</strong> protocol.</p>
</div>
<div class="sect2">
<h3 id="_authentication"><a class="anchor" href="#_authentication"></a>5.1. Authentication</h3>
<div class="paragraph">
<p>In accordance with SMART protocol, the authentication is often a step of the authorization process. Also, for the end-user identity verification steps of the authentication protocol an external framework should be used, such as <a href="https://openid.net/specs/openid-connect-core-1_0.html#Authentication" target="_blank" rel="noopener">OpenID Connect (OIDC)</a>, but the exact method is beyond the scope of this specification.</p>
</div>
<div class="sect3">
<h4 id="_available_flows"><a class="anchor" href="#_available_flows"></a>5.1.1. Available flows</h4>
<div class="paragraph">
<p>The client <em>Application</em> can authenticate with the <em>Platform</em> using the <strong>SMART on openEHR</strong>, based on the following flows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.1" target="_blank" rel="noopener">OAuth2 Authorization Code</a> flow with <a href="https://tools.ietf.org/html/rfc7636" target="_blank" rel="noopener">Proof Key for Code Exchange (PKCE)</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.1" target="_blank" rel="noopener">OAuth2 Authorization Code</a> flow with <code>client_secret</code></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.4" target="_blank" rel="noopener">OAuth2 Client Credentials</a> flow</p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc7523" target="_blank" rel="noopener">JWT Assertion</a> flow with <a href="https://tools.ietf.org/html/rfc7515" target="_blank" rel="noopener">JSON Web Signature (JWS)</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The supported authentication flows should be advertised by the <em>Platform</em> in the <code>.well-known/smart-configuration</code> endpoint.</p>
</div>
<div class="paragraph">
<p>SMART protocol distinguish two types of authentication types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.hl7.org/fhir/smart-app-launch/client-confidential-asymmetric.html" target="_blank" rel="noopener">Asymmetric authentication</a>:
this is the SMART preferred authentication method because it avoids sending a shared secret over the wire. It can use one of the <a href="https://tools.ietf.org/html/rfc6749#section-1.3.4" target="_blank" rel="noopener">OAuth2 Client Credentials</a> or <a href="https://tools.ietf.org/html/rfc7523" target="_blank" rel="noopener">JWT Assertion</a> flow</p>
</li>
<li>
<p><a href="https://www.hl7.org/fhir/smart-app-launch/client-confidential-symmetric.html" target="_blank" rel="noopener">Symmetric authentication</a>:
authenticates a client application using a secret that has been pre-shared between the client and server. It can use the <a href="https://tools.ietf.org/html/rfc6749#section-1.3.1" target="_blank" rel="noopener">OAuth2 Authorization Code</a> flow with <code>client_secret</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following flows are considered legacy and should not be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.2" target="_blank" rel="noopener">Implicit Flow</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.3" target="_blank" rel="noopener">Resource Owner Password Credentials</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_application_types"><a class="anchor" href="#_application_types"></a>5.1.2. Application types</h4>
<div class="paragraph">
<p>The recommended authentication flow depends also on the type of the client <em>Application</em>. There is a distinction between applications based on whether they can hold their credentials (e.g. client secrets) or are capable to secure the client authentication using other means. The following types of client applications are <a href="https://www.hl7.org/fhir/smart-app-launch/app-launch.html#support-for-public-and-confidential-apps" target="_blank" rel="noopener">considered by SMART</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Confidential</strong> applications: they have the ability to hold a credentials. This includes web applications running on a trusted server, uses additional technology for higher security and backend applications.</p>
</li>
<li>
<p><strong>Public</strong> applications: they do not have the ability to hold a client secret. This includes mobile applications and single page web applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The distinction on the client application types can also be made on the basis of the <em>user interaction</em>. The following types are considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Patient facing</strong>: The patient is the direct end-user of this application, or is opened up by a practitioner within the context of a single patient. It can also be opened within the context of an episode related to a patient, but is optional.</p>
</li>
<li>
<p><strong>Practitioner facing</strong>: The practitioner is the end-user of this application. It can be optionally opened up within the context of a patient, or episode.</p>
</li>
<li>
<p><strong>Backend service</strong>: The application is not directly used by an end-user, but is used by another applications or services in the background.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended that Patient and Practitioner facing applications use one of the Authorization Code Flows to obtain necessary user information and context. Confidential clients can use the Authorization Code Flow with PKCE or the Authorization Code Flow with Client Secret. Public clients should always use the Authorization Code Flow with PKCE. Backend applications should always use confidential clients and use the JWT Assertion Flow with JWS or the Client Credentials Flow.</p>
</div>
<div class="paragraph">
<p>The following table shows the recommended flow for a few example applications:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 35.7142%;">
<col style="width: 14.2857%;">
<col style="width: 21.4285%;">
<col style="width: 28.5716%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Application Example</th>
<th class="tableblock halign-left valign-top">Client Type</th>
<th class="tableblock halign-left valign-top">User interaction type</th>
<th class="tableblock halign-left valign-top">Recommended Flow</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Page Web Application for a Patient Portal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patient facing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization Code Flow with PKCE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobile Application for tracking heart rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patient facing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization Code Flow with PKCE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Application with Backend for cardiology management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confidential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Practitioner facing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization Code Flow with PKCE or Authorization Code Flow with <code>client_secret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Realtime alert system for hospital</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confidential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backend service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT Assertion Flow with JWS or Client Credentials Flow</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_smart_authorization_flow"><a class="anchor" href="#_smart_authorization_flow"></a>5.2. SMART Authorization Flow</h3>
<div class="paragraph">
<p>Both Patient and Practitioner facing applications have special requirements that cannot be fulfilled only by the standard OAuth2 framework specification. SMART on FHIR <a href="https://www.hl7.org/fhir/smart-app-launch/app-launch.html#smart-authorization&#8212;&#8203;fhir-access-overview" target="_blank" rel="noopener">specifies</a> that depending on the session context, applications can be launched in two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Standalone launch</strong>: The Application is opened directly by the end-user, launched outside the end-user session context on the Platform - e.g. by launching the app at <code>https://myapp.example.com</code>. The application decides which Platform to use based on the user&#8217;s selection.</p>
</li>
<li>
<p><strong>EHR launch</strong>: The Application is often embedded within the Platform&#8217;s main user-interface (i.e. a Portal) using an <code>iFrame</code>. Additional parameters <code>launch</code> and <code>iss</code> are passed to the Application to indicate the Platform to use, and the launch context - e.g. <code>https://myapp.example.com?launch=123&amp;iss=https://platform.example.com</code>. This launch method is also referred to as <strong>Embedded iFrame Launch</strong> to avoid potential confusion in relation with <a href="https://specifications.openehr.org/releases/RM/latest/ehr.html#_ehr_package" target="_blank" rel="noopener">openEHR Reference Model <code>EHR</code></a> specification.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Authorization Code Flow as <a href="https://tools.ietf.org/html/rfc6749#section-4.1" target="_blank" rel="noopener">defined in OAuth2 framework</a> is a two-step process where:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client first requests an authorization code from the authorization server by redirecting the user to the <code>authorization_endpoint</code>.</p>
</li>
<li>
<p>Subsequently, the client exchanges the authorization code for an access token by using the <code>token_endpoint</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The SMART protocol specifies a few modifications to the Authorization Code Flow to enhance it for the use-case of Standalone and Embedded iFrame launch, which are described in the following sections.</p>
</div>
<div class="sect3">
<h4 id="_context_selection"><a class="anchor" href="#_context_selection"></a>5.2.1. Context Selection</h4>
<div class="paragraph">
<p>In the <em>Standalone launch</em>, a client <em>Application</em> can request (invoke) the <em>Platform</em> for the context selection, if relevant <code>context-\*</code> prefixed capabilities are available on the <em>Platform</em>. Most Patient and Practitioner facing application will also require during authorization process the <em>Platform</em> to determine and send additional <strong>context</strong> data. This may contain information like the openEHR EHR ID or Patient ID, potentially the Episode ID, and it may be valid for a lifetime of the end-user session.</p>
</div>
<div id="smart_standalone_launch" class="imageblock text-center text-center">
<div class="content">
<img src="smart_app_launch/diagrams/smart_standalone_launch.svg" alt="smart standalone launch">
</div>
<div class="title">Figure 2. Standalone Launch</div>
</div>
<div class="paragraph">
<p>This <em>context</em> data can be used to pre-populate the client <em>Application</em> with the correct data.
The <em>Platform</em> can do this by automatically inferring the <em>context</em> based on the logged-in user, or can provide a screen right after the consent page to select the <em>context</em> in case of ambiguity.</p>
</div>
<div class="paragraph">
<p>The <em>Application</em> can request the <em>Platform</em> for openEHR related context selection by passing the following special <strong>scopes</strong> in the authorization request:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>launch/patient</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Need patient context at launch time (FHIR Patient resource and openEHR EHR). When launching outside the EHR, ask for the openEHR EHR instance to be selected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>launch/episode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Need episode context at launch time (this is experimental, the semantic and the resource is to be determined).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The context data populated by the <em>Platform</em> is returned in the token response along with the <code>id_token</code> and <code>access_token</code>. The following additional parameters (besides those <a href="https://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context.html#launch-context-arrives-with-your-access_token" target="_blank" rel="noopener">described by FHIR</a>) are added to the token response:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ehrId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the openEHR EHR instance associated with the FHIR Patient resource selected in the launch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">episodeId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the Episode selected in the launch (this is experimental, the semantic and the resource is to be determined).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The application can make use of these parameters to render the correct information to the end-user.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context.html" target="_blank" rel="noopener">launch scopes</a> and token attributes from SMART on FHIR can also be combined here for backward compatibility, but they are not covered by this specification.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_embedded_iframe_launch"><a class="anchor" href="#_embedded_iframe_launch"></a>5.2.2. Embedded iFrame Launch</h4>
<div class="paragraph">
<p>Most Practitioner facing, as well as some Patient facing applications will have to be embedded within the end-user&#8217;s web based front-end (i.e. a Portal) by using an <code>iFrame</code>.</p>
</div>
<div class="paragraph">
<p>The <em>Platform</em> can automatically communicate the correct <em>context</em> for the client <em>Application</em> by passing the <code>launch</code> parameter to the application&#8217;s url. The <em>Platform</em> should also provide the <code>iss</code> parameter to indicate its endpoint for the application to use (which for FHIR SMART apps compatibility reasons represents also the FHIR server endpoint).
As an example, an application can be launched by a URL like: <code>https://myapp.example.com?launch=123&amp;iss=https://platform.example.com</code>.</p>
</div>
<div id="smart_embedded_iframe_launch" class="imageblock text-center text-center">
<div class="content">
<img src="smart_app_launch/diagrams/smart_embedded_iframe_launch.svg" alt="smart embedded iframe launch">
</div>
<div class="title">Figure 3. Embedded iFrame Launch</div>
</div>
<div class="paragraph">
<p>The application can then use the <code>iss</code> parameter to obtain the <em>Platform</em> configuration from the <code>.well-known/smart-configuration</code> endpoint. It then uses the <code>authorization_endpoint</code> to start the Authorization Code Flow. The <code>launch</code> parameter is passed along to the authorization request.</p>
</div>
<div class="paragraph">
<p>The following <strong>scope</strong> is also mandatory while passing the <code>launch</code> parameter:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>launch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to obtain launch context when Application is launched from an EHR (Embedded iFrame Launch). This should be accompanied by an additional <code>launch</code> parameter in the authorization request.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It is recommended that the <code>launch</code> token be a base64 encoded JSON object, containing the <em>context</em> attributes like the <code>ehrId</code>, along with other attributes. The client <em>Application</em> can use this information to pre-populate itself without initiating an authorization request if it is already authenticated. This will enable a seamless experience for the user when switching between patients while using the application within an <code>iFrame</code>. This capability can be advertised by adding the <code>launch-base64-json</code> <em>capability</em> in the <code>/.well-known/smart-configuration</code> response.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scopes_for_openehr_rest_api"><a class="anchor" href="#_scopes_for_openehr_rest_api"></a>5.3. Scopes for openEHR REST API</h3>
<div class="paragraph">
<p>The <em>Application</em> can request access to the <em>Platform</em> resources using the <a href="https://tools.ietf.org/html/rfc6749#section-3.3" target="_blank" rel="noopener">OAuth2.0 scopes</a>. <a href="https://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context.html" target="_blank" rel="noopener">SMART defines</a> the scope syntax as follows:</p>
</div>
<div class="paragraph">
<p><code>&lt;compartment&gt;/&lt;resource&gt;.&lt;permission&gt;</code></p>
</div>
<div class="paragraph">
<p>The scopes are based on 3 different <em>compartments</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>patient/*</code>: These scopes are used when the EHR ID is present in the context. Only access to resources in the compartment of the EHR ID is allowed.</p>
</li>
<li>
<p><code>user/*</code>: These scopes are used when the user is identified by the Platform. It is usually a practitioner or an administrator. Only access to resources that the user would usually have access to is allowed.</p>
</li>
<li>
<p><code>system/*</code>: These scopes are used when the user is not available and the application is a backend confidential application. These scopes are obtained in advance while registering the application and provides (unrestricted) access to resources in the Platform.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the <a href="https://specifications.openehr.org/releases/ITS-REST/latest">openEHR REST APIs</a> the following <em>resource expressions</em> are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>template-&lt;templateId&gt;</code>: Templates which match the &lt;templateId&gt; expression.</p>
</li>
<li>
<p><code>composition-&lt;templateId&gt;</code>: Compositions of the templates which match the &lt;templateId&gt; expression.</p>
</li>
<li>
<p><code>aql-&lt;queryName&gt;</code>: AQL Queries that match the &lt;queryName&gt; expression. If the &lt;queryName&gt; is <code>*</code>, then all queries as well as ad-hoc queries are allowed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&lt;templateId&gt;</code> in the above definition follows the blob pattern matching delimited by a <code>.</code> period. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MyHospital.Template.v0</code> - Matches only <code>MyHospital.Template.v0</code></p>
</li>
<li>
<p><code>*.Template.v0</code> - Matches <code>MyHospital.Template.v0</code> and <code>OtherHospital.Template.v0</code></p>
</li>
<li>
<p><code>MyHospital.**</code> - Matches <code>MyHospital.Template.v0</code>, <code>MyHospital.Template.v2</code> and <code>MyHospital.OtherTemplate.v0</code></p>
</li>
<li>
<p><code>*</code> - Matches all templates in the system</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&lt;queryName&gt;</code> in the above definition follows the blob pattern matching delimited by <code>.</code> a period. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.openehr::compositions</code> - Matches only <code>org.openehr::compositions</code></p>
</li>
<li>
<p><code>org.openehr::*</code> - Matches <code>org.openehr::compositions</code> and <code>org.openehr::bloodpressure</code></p>
</li>
<li>
<p><code>org.openehr::**</code> - Matches <code>org.openehr::compositions</code>, <code>org.openehr::bloodpressure</code>, <code>org.openehr::bloodpressure.v1</code></p>
</li>
<li>
<p><code>*</code> - Matches all queries and ad-hoc queries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following <em>permission</em> expressions are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c</code>: The ability to create a resource.</p>
</li>
<li>
<p><code>r</code>: The ability to read a resource.</p>
</li>
<li>
<p><code>u</code>: The ability to update a resource.</p>
</li>
<li>
<p><code>d</code>: The ability to delete a resource.</p>
</li>
<li>
<p><code>s</code>: The ability to search a resource. In case of <code>aql-&lt;queryName&gt;</code> scope, this means the ability to execute the query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table is a maximal representation of the scopes made possible in different <em>compartment</em>, <em>resource</em> and <em>permission</em> combinations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patient/composition-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update and delete compositions of <code>&lt;templateId&gt;</code> that are within the EHR of the patient in context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user/composition-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update and delete compositions of <code>&lt;templateId&gt;</code> that are within the EHRs the logged-in user has access to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system/composition-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update and delete compositions of <code>&lt;templateId&gt;</code> of all EHRs in the system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patient/template-&lt;templateId&gt;.r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to read a template with <code>&lt;templateId&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user/template-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create and read a template with <code>&lt;templateId&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system/template-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update and delete a template with <code>&lt;templateId&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patient/aql-&lt;queryName&gt;.rs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to read and execute AQL with <code>&lt;queryName&gt;</code> on EHR ID of the patient in context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user/aql-&lt;queryName&gt;.cruds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update, delete and execute AQL with &lt;queryName&gt; on EHR IDs that the logged-in user has access to. If <code>&lt;queryName&gt;</code> is equal to the wildcard <code>*</code>, this scope will allow the ad-hoc query endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system/aql-&lt;queryName&gt;.cruds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update, delete and execute AQL with <code>&lt;queryName&gt;</code>. If <code>&lt;queryName&gt;</code> is equal to the wildcard <code>*</code>, this scope will allow the ad-hoc query endpoint.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p>SMART App Launch - Release 2.1.0 (2021), <a href="https://www.hl7.org/fhir/smart-app-launch" class="bare">https://www.hl7.org/fhir/smart-app-launch</a></p>
</li>
<li>
<p>The 'About SMART' page on SMART Health IT, <a href="https://smarthealthit.org/about-smart-2/" class="bare">https://smarthealthit.org/about-smart-2/</a></p>
</li>
<li>
<p>OAuth2 Framework, <a href="https://tools.ietf.org/html/rfc6749" class="bare">https://tools.ietf.org/html/rfc6749</a></p>
</li>
<li>
<p>OpenId Connect (OIDC), <a href="https://openid.net/specs/openid-connect-core-1_0.html#Authentication" class="bare">https://openid.net/specs/openid-connect-core-1_0.html#Authentication</a></p>
</li>
<li>
<p>JSON Web Token (JWT) Assertion, <a href="https://tools.ietf.org/html/rfc7523" class="bare">https://tools.ietf.org/html/rfc7523</a></p>
</li>
<li>
<p>JSON Web Signature (JWS), <a href="https://tools.ietf.org/html/rfc7515" class="bare">https://tools.ietf.org/html/rfc7515</a></p>
</li>
<li>
<p>Best Practices in Authorization for SMART on FHIR EHRs, <a href="https://docs.smarthealthit.org/authorization/best-practices" class="bare">https://docs.smarthealthit.org/authorization/best-practices</a></p>
</li>
</ul>
</div>
<div id="smart_logo" class="imageblock text-center">
<div class="content">
<a class="image" href="https://smarthealthit.org/"><img src="smart_app_launch/diagrams/smart_logo.svg" alt="SMART" width="140" height="80"></a>
</div>
<div class="title">SMART™ and the SMART logos are trademarks of The Children&#8217;s Medical Center Corporation. Used with permission.</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-03-07 00:37:22 UTC
</div>
</div>
</body>
</html>